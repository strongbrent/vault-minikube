dist: xenial
os: linux
sudo: required
services:
- docker

env:
- CHANGE_MINIKUBE_NONE_USER=true

before_install:
# Upgrade Docker
- sudo apt-get update
- sudo apt-get -y -o Dpkg::Options::="--force-confnew" install docker-ce

install:
- scripts/ci/install_deps.sh

before_script:
- sudo minikube start --memory=4096 --vm-driver=none
- sudo chown -R $USER ${HOME}/.{mini,}kube

script:
# Build from scratch
- make workstation

# Test idempotency (no clobbering)
- make workstation

# Test to ensure tha consul is running
- curl -LI http://localhost:8500/ui/dc1/services -o /dev/null -w '%{http_code}\n' -s

  # TODO: Test to ensure that vault is running 

# Test teardown
- make clean

# Test teardown idempotency
- make clean

# Test destroy
- make destroy

